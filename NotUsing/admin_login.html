<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ë¡œê·¸ì¸</title>
    <!-- ê´€ë¦¬ì ì „ìš© CSS íŒŒì¼ì„ ì—°ê²°í•©ë‹ˆë‹¤. -->
    <link rel="stylesheet" href="/admin_login.css"> 
    <link rel="icon" href="/memora.ico">
</head>
<body>
    <div class="top-bar">
        <a href="/"><img src="/memorab.png" width="300" alt="Memora ë¡œê³ "></a>
    </div>

    <form id="adminLoginForm">
        <table>
            <tr>
                <td><h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2></td>
            </tr>
            <tr>
                <td><input type="text" id="username" placeholder="Admin ID" required></td>
            </tr>
            <tr>
                <td><input type="password" id="password" placeholder="Password" required></td>
            </tr>
            <tr>
               <td>
                <label for="remember-check">
                    <input type="checkbox" id="remember-check">ì•„ì´ë”” ì €ì¥í•˜ê¸°
                </label>
               </td>
            </tr>
           <tr>
                <td><input type="submit" value="ë¡œê·¸ì¸" class="btn"></td>
            </tr>
            <!-- ê´€ë¦¬ì í˜ì´ì§€ì—ì„œëŠ” íšŒì›ê°€ì… ë§í¬ê°€ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì œê±°í–ˆìŠµë‹ˆë‹¤. -->
        </table>
    </form>
    <div id="messageArea" style="text-align: center; margin-top: 15px; min-height: 20px;"></div>

    <script>
    // JavaScriptë¥¼ HTML íŒŒì¼ ë‚´ì— ì§ì ‘ ì‘ì„±í•©ë‹ˆë‹¤.
    document.addEventListener('DOMContentLoaded', () => {
        const loginForm = document.getElementById('adminLoginForm');
        const messageArea = document.getElementById('messageArea');

        loginForm.addEventListener('submit', async (event) => {
            event.preventDefault();

            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const rememberCheck = document.getElementById('remember-check');
            
            messageArea.textContent = ''; // ì´ì „ ë©”ì‹œì§€ ì‚­ì œ

            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            if (!username || !password) {
                messageArea.textContent = 'ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                return;
            }

            try {
                // ğŸš¨ ì¤‘ìš”: ê´€ë¦¬ì ë¡œê·¸ì¸ API(/api/admin/login)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password }),
                });

                const data = await response.json();

                if (response.ok) {
                    alert(data.message || 'ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ!');

                    // â–¼â–¼â–¼ [ë§¤ìš° ì¤‘ìš”] ì €ì¥í•˜ëŠ” í‚¤ë¥¼ ì¼ë°˜ ë¡œê·¸ì¸ê³¼ í†µì¼í•©ë‹ˆë‹¤ â–¼â–¼â–¼
                    localStorage.setItem('authToken', data.token);
                    localStorage.setItem('userData', JSON.stringify(data.user));
                    // â–²â–²â–² ì—¬ê¸°ê¹Œì§€ ìˆ˜ì • â–²â–²â–²

                    // "ì•„ì´ë”” ì €ì¥" ì²˜ë¦¬
                    if (rememberCheck.checked) {
                        localStorage.setItem('rememberedUsername', username); // ì´ í‚¤ë„ í†µì¼
                    } else {
                        localStorage.removeItem('rememberedUsername');
                    }

                    // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë””ë ‰ì…˜
                    window.location.href = '/admin/dashboard';

                } else {
                    messageArea.style.color = 'red';
                    messageArea.textContent = data.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                    passwordInput.value = '';
                }
            } catch (error) {
                console.error('ê´€ë¦¬ì ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                messageArea.style.color = 'red';
                messageArea.textContent = 'ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            }
        });

        // "ì•„ì´ë”” ì €ì¥"ëœ ê´€ë¦¬ì ì•„ì´ë””ê°€ ìˆìœ¼ë©´ í•„ë“œ ì±„ìš°ê¸°
        const rememberedUsername = localStorage.getItem('rememberedAdminUsername');
        if (rememberedUsername) {
            document.getElementById('username').value = rememberedUsername;
            document.getElementById('remember-check').checked = true;
        }
    });
    </script>
</body>
</html>